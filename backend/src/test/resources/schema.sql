-- Minimal schema for ROI & cost aggregation tests (H2 compatible)
CREATE TABLE IF NOT EXISTS CAMPAIGN_COSTS (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CAMPAIGN_ID BIGINT NOT NULL,
    CATEGORY_CODE VARCHAR(50) NOT NULL,
    SUBCATEGORY VARCHAR(100),
    COST_DATE DATE NOT NULL,
    AMOUNT DOUBLE PRECISION NOT NULL,
    CURRENCY VARCHAR(10) NOT NULL,
    QUANTITY DOUBLE PRECISION,
    UNIT_COST DOUBLE PRECISION,
    NOTES VARCHAR(400),
    ORG_ID BIGINT,
    CREATED_AT TIMESTAMP
);

CREATE TABLE IF NOT EXISTS COST_DAILY_AGG (
    ORG_ID BIGINT NOT NULL,
    COST_DATE DATE NOT NULL,
    TOTAL_COST DOUBLE PRECISION,
    BASE_CURRENCY VARCHAR(10),
    PRIMARY KEY (ORG_ID, COST_DATE)
);

CREATE TABLE IF NOT EXISTS CAMPAIGN_METRICS_DAILY (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CAMPAIGN_ID BIGINT NOT NULL,
    METRIC_DATE DATE NOT NULL,
    REVENUE DOUBLE PRECISION
);

CREATE TABLE IF NOT EXISTS ROI_GOALS (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CAMPAIGN_ID BIGINT NOT NULL UNIQUE,
    TARGET_ROI_PCT DOUBLE PRECISION,
    TARGET_MARGIN_PCT DOUBLE PRECISION,
    CREATED_AT TIMESTAMP,
    UPDATED_AT TIMESTAMP,
    ORG_ID BIGINT
);

CREATE TABLE IF NOT EXISTS EXCHANGE_RATES (
    BASE_CURRENCY VARCHAR(10) NOT NULL,
    QUOTE_CURRENCY VARCHAR(10) NOT NULL,
    RATE_DATE DATE NOT NULL,
    RATE DOUBLE PRECISION,
    PRIMARY KEY (BASE_CURRENCY, QUOTE_CURRENCY, RATE_DATE)
);

CREATE TABLE IF NOT EXISTS CUSTOMER_CONVERSIONS (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CAMPAIGN_ID BIGINT NOT NULL,
    CUSTOMER_ID VARCHAR(100) NOT NULL,
    CONVERSION_DATE DATE NOT NULL,
    REVENUE_AMOUNT DOUBLE PRECISION NOT NULL,
    LIFETIME_VALUE DOUBLE PRECISION,
    CREATED_AT TIMESTAMP
);

CREATE TABLE IF NOT EXISTS ROI_BENCHMARKS (
    INDUSTRY_CODE VARCHAR(60) NOT NULL,
    METRIC VARCHAR(60) NOT NULL,
    BENCH_VALUE DOUBLE PRECISION NOT NULL,
    PRIMARY KEY (INDUSTRY_CODE, METRIC)
);

CREATE TABLE IF NOT EXISTS ROI_ANALYSIS (
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CAMPAIGN_ID BIGINT NOT NULL,
    ANALYSIS_DATE DATE NOT NULL,
    BASE_CURRENCY VARCHAR(10),
    TOTAL_COST_BASE DOUBLE PRECISION,
    TOTAL_REVENUE_BASE DOUBLE PRECISION,
    ROI_PCT DOUBLE PRECISION,
    PROFIT_MARGIN_PCT DOUBLE PRECISION,
    GENERATED_AT TIMESTAMP
);

-- Seed generic benchmark
MERGE INTO ROI_BENCHMARKS (INDUSTRY_CODE, METRIC, BENCH_VALUE) KEY(INDUSTRY_CODE, METRIC)
    VALUES ('GENERIC','ROI_PCT', 35.0);

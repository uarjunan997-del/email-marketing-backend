-- Industry Benchmarking Schema
CREATE TABLE benchmark_metrics (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  industry VARCHAR2(64) NOT NULL,
  list_tier VARCHAR2(16) NOT NULL, -- TIER1:1-1K, TIER2:1K-10K, TIER3:10K-100K, TIER4:100K+
  region VARCHAR2(16) NOT NULL, -- NA, EU, APAC
  open_rate_median NUMBER(6,4), open_rate_top_q NUMBER(6,4), open_rate_bottom_q NUMBER(6,4),
  click_rate_median NUMBER(6,4), click_rate_top_q NUMBER(6,4), click_rate_bottom_q NUMBER(6,4),
  conversion_rate_median NUMBER(6,4), conversion_rate_top_q NUMBER(6,4), conversion_rate_bottom_q NUMBER(6,4),
  revenue_per_email_median NUMBER(12,6), revenue_per_email_top_q NUMBER(12,6), revenue_per_email_bottom_q NUMBER(12,6),
  bounce_rate_median NUMBER(6,4), bounce_rate_top_q NUMBER(6,4), bounce_rate_bottom_q NUMBER(6,4),
  updated_at TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
  UNIQUE(industry, list_tier, region)
);
CREATE INDEX idx_bm_industry_region ON benchmark_metrics(industry, region);

CREATE TABLE user_industry_classification (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id NUMBER(19) NOT NULL,
  industry VARCHAR2(64) NOT NULL,
  confidence NUMBER(5,4) NOT NULL,
  method VARCHAR2(32) NOT NULL,
  created_at TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL
);
CREATE INDEX idx_user_industry ON user_industry_classification(user_id, created_at);

CREATE TABLE benchmark_comparisons (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id NUMBER(19) NOT NULL,
  industry VARCHAR2(64) NOT NULL,
  list_tier VARCHAR2(16) NOT NULL,
  region VARCHAR2(16) NOT NULL,
  computed_at TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
  open_rate_user NUMBER(6,4), click_rate_user NUMBER(6,4), conversion_rate_user NUMBER(6,4), revenue_per_email_user NUMBER(12,6), bounce_rate_user NUMBER(6,4),
  open_rate_median NUMBER(6,4), click_rate_median NUMBER(6,4), conversion_rate_median NUMBER(6,4), revenue_per_email_median NUMBER(12,6), bounce_rate_median NUMBER(6,4),
  open_rate_percentile NUMBER(5,2), click_rate_percentile NUMBER(5,2), conversion_rate_percentile NUMBER(5,2), bounce_rate_percentile NUMBER(5,2), revenue_per_email_percentile NUMBER(5,2),
  performance_score VARCHAR2(16),
  recommendations CLOB
);
CREATE INDEX idx_bench_comp_user ON benchmark_comparisons(user_id, computed_at);

-- Seed baseline benchmark data (NA region, can duplicate for EU/APAC with slight variance)
INSERT INTO benchmark_metrics(industry,list_tier,region,open_rate_median,click_rate_median,revenue_per_email_median,open_rate_top_q,click_rate_top_q,revenue_per_email_top_q,open_rate_bottom_q,click_rate_bottom_q,revenue_per_email_bottom_q,conversion_rate_median,conversion_rate_top_q,conversion_rate_bottom_q,bounce_rate_median,bounce_rate_top_q,bounce_rate_bottom_q)
VALUES ('ECOMMERCE','TIER2','NA',0.1839,0.0245,0.080000,0.2300,0.0300,0.110000,0.1200,0.0150,0.040000,0.0150,0.0220,0.0090,0.0120,0.0080,0.0200);
INSERT INTO benchmark_metrics(industry,list_tier,region,open_rate_median,click_rate_median,revenue_per_email_median,open_rate_top_q,click_rate_top_q,revenue_per_email_top_q,open_rate_bottom_q,click_rate_bottom_q,revenue_per_email_bottom_q,conversion_rate_median,conversion_rate_top_q,conversion_rate_bottom_q,bounce_rate_median,bounce_rate_top_q,bounce_rate_bottom_q)
VALUES ('SAAS','TIER2','NA',0.2012,0.0268,0.670000,0.2600,0.0340,0.900000,0.1400,0.0180,0.300000,0.0200,0.0300,0.0120,0.0110,0.0070,0.0190);
INSERT INTO benchmark_metrics(industry,list_tier,region,open_rate_median,click_rate_median,revenue_per_email_median,open_rate_top_q,click_rate_top_q,revenue_per_email_top_q,open_rate_bottom_q,click_rate_bottom_q,revenue_per_email_bottom_q,conversion_rate_median,conversion_rate_top_q,conversion_rate_bottom_q,bounce_rate_median,bounce_rate_top_q,bounce_rate_bottom_q)
VALUES ('HEALTHCARE','TIER2','NA',0.2215,0.0312,0.540000,0.2800,0.0400,0.700000,0.1600,0.0200,0.350000,0.0180,0.0260,0.0100,0.0100,0.0060,0.0180);
INSERT INTO benchmark_metrics(industry,list_tier,region,open_rate_median,click_rate_median,revenue_per_email_median,open_rate_top_q,click_rate_top_q,revenue_per_email_top_q,open_rate_bottom_q,click_rate_bottom_q,revenue_per_email_bottom_q,conversion_rate_median,conversion_rate_top_q,conversion_rate_bottom_q,bounce_rate_median,bounce_rate_top_q,bounce_rate_bottom_q)
VALUES ('EDUCATION','TIER2','NA',0.2846,0.0423,0.340000,0.3400,0.0550,0.430000,0.1900,0.0260,0.150000,0.0250,0.0340,0.0150,0.0110,0.0070,0.0200);
INSERT INTO benchmark_metrics(industry,list_tier,region,open_rate_median,click_rate_median,revenue_per_email_median,open_rate_top_q,click_rate_top_q,revenue_per_email_top_q,open_rate_bottom_q,click_rate_bottom_q,revenue_per_email_bottom_q,conversion_rate_median,conversion_rate_top_q,conversion_rate_bottom_q,bounce_rate_median,bounce_rate_top_q,bounce_rate_bottom_q)
VALUES ('NON_PROFIT','TIER2','NA',0.2467,0.0345,0.180000,0.3000,0.0450,0.260000,0.1700,0.0220,0.090000,0.0200,0.0280,0.0120,0.0100,0.0060,0.0170);
COMMIT;
